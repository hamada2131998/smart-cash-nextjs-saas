# Smart Cash & Custody SaaS - Production-Ready

Ù…Ù†ØµØ© SaaS Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ø´ â€“ Ø§Ù„Ø¹Ù‡Ø¯ â€“ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª â€“ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø©.

## ğŸš€ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### âœ… Ø§Ù„Ù…ÙÙ†Ø¬Ø²Ø©
- âœ… Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„/Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Onboarding ØªÙ„Ù‚Ø§Ø¦ÙŠ
- âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ© ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
- âœ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ù…Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ø±ØµÙŠØ¯
- âœ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
- âœ… Auto-approve Ù„Ù„Ù…Ø¨Ø§Ù„Øº < 500 SAR
- âœ… Ø®ØµÙ… Ø§Ù„Ø¹Ù‡Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯
- âœ… Ù†Ø¸Ø§Ù… Ø³ÙŠØ§Ø³Ø§Øª Ù…Ø±Ù†
- âœ… Row Level Security (RLS) ÙƒØ§Ù…Ù„
- âœ… Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ Supabase Storage
- âœ… Dashboard Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©
- âœ… ÙˆØ§Ø¬Ù‡Ø© Ù…ØªØ¬Ø§ÙˆØ¨Ø© (Desktop + Mobile)

## ğŸ“‹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª

- Node.js 18+
- npm or yarn
- Ø­Ø³Ø§Ø¨ Supabase (Ù…Ø¬Ø§Ù†ÙŠ ÙŠÙƒÙÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
- Git (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

## ğŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±ÙŠØ¹

### 1. Ø§Ø³ØªÙ†Ø³Ø® Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```bash
cd "C:\Users\home\Desktop\Ù‚ÙŠÙˆØ¯ Ø­Ù…Ø§Ø¯Ø©\HAMADA SYSTEM"
```

### 2. ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª

```bash
npm install
```

### 3. Ø¥Ø¹Ø¯Ø§Ø¯ Supabase

#### Ø£) Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯

1. Ø§ÙØªØ­ https://supabase.com
2. Ø£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ (Project Name: `smart-cash-saas`, Region:å°±è¿‘)
3. Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªØ¬Ù‡ÙŠØ² (~2 Ø¯Ù‚ÙŠÙ‚Ø©)

#### Ø¨) Ø´ØºÙ„ Migration SQL

1. Ù…Ù† Supabase Dashboard:
   - SQL Editor
   - New Query
   - Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ `supabase/migrations/010_saas_production_patch.sql`
   - Ø§Ø¶ØºØ· "Run"

#### Ø¬) ØªÙØ¹ÙŠÙ„ Email Auth

1. Ù…Ù† Supabase Dashboard:
   - Authentication â†’ Providers â†’ Email
   - ØªØ£ÙƒØ¯ Ø£Ù† Email provider Ù…ÙØ¹Ù‘Ù„
   - (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ÙØ¹Ù‘Ù„ Confirm Email Ù„Ù„Ø¥Ù†ØªØ§Ø¬

#### Ø¯) Ø¥Ù†Ø´Ø§Ø¡ Storage Bucket

SQL Migration Ø³ÙŠÙ†Ø´Ø¦ Ø§Ù„Ù€ bucket ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† ØªØ£ÙƒØ¯:

1. Ù…Ù† Supabase Dashboard:
   - Storage â†’ New bucket
   - Name: `expense_attachments`
   - Public: âŒ (private)
   - File size limit: 5MB
   - Allowed MIME types: `image/*, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document`

### 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©

Ø§Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ù:

```bash
cp .env.local.example .env.local
```

Ø¹Ø¯Ù‘Ù„ `.env.local`:

```env
# Ù…Ù† Supabase Dashboard â†’ Project Settings â†’ API
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=Smart Cash & Custody
```

### 5. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```bash
# ÙˆØ¶Ø¹ Ø§Ù„ØªØ·ÙˆÙŠØ±
npm run dev

# Ø§ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰:
http://localhost:3000
```

## ğŸ§ª Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ (Contracting)

1. Ø§ÙØªØ­ http://localhost:3000/auth/register
2. Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª:
   - Ø§Ù„Ø§Ø³Ù…: `Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯`
   - Ø§Ù„Ø¨Ø±ÙŠØ¯: `ahmed@test.com`
   - ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: `Test123456`
   - Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©: `Ø´Ø±ÙƒØ© Ø§Ù„Ø£ÙÙ‚`
   - Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·: `Ù…Ù‚Ø§ÙˆÙ„Ø§Øª`
3. Ø§Ø¶ØºØ· "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨"
4. Ø³ØªØªÙˆØ¬Ù‡ Ù„Ù€ /dashboard ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ company Ø¬Ø¯ÙŠØ¯Ø©
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ profile Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø´Ø±ÙƒØ©
- âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± `owner`
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 8 expense categories Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 2 projects Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ù„Ø£Ù† activity_type = contracting)
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 2 cost centers Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ custody Ù„Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø±ØµÙŠØ¯ 0

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¨Ø³ÙŠØ· (Auto-approve)

1. Ù…Ù† Dashboard â†’ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
2. Ø£Ø¯Ø®Ù„:
   - Ø§Ù„ÙˆØµÙ: `ÙˆÙ‚ÙˆØ¯ Ø³ÙŠØ§Ø±Ø©`
   - Ø§Ù„Ù…Ø¨Ù„Øº: `300`
   - Ø§Ù„ØªØµÙ†ÙŠÙ: `ÙˆÙ‚ÙˆØ¯`
   - ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù‡Ø¯: Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù‡Ø¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ
3. Ø§Ø¶ØºØ· "Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ"

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ expense Ø¨Ù€ status = `approved`
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ approval Ø¨Ù€ status = `approved` + `auto_approved = true`
- âœ… ØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† custody balance
- âœ… Ù„Ø§ ÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© "Ù‚ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©"

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ù…ØµØ±ÙˆÙ ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©

1. Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯:
   - Ø§Ù„ÙˆØµÙ: `Ø´Ø±Ø§Ø¡ Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡`
   - Ø§Ù„Ù…Ø¨Ù„Øº: `800` (Ø£ÙƒØ«Ø± Ù…Ù† 500)
   - Ø§Ù„ØªØµÙ†ÙŠÙ: `Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ù…ÙƒØªØ¨ÙŠØ©`
   - Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: Ø§Ø®ØªØ± project
   - Ù…Ø±ÙƒØ² Ø§Ù„ØªÙƒÙ„ÙØ©: Ø§Ø®ØªØ± cost center
2. Ø§Ø¶ØºØ· "Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ"

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ expense Ø¨Ù€ status = `submitted`
- âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ approval Ø¨Ù€ status = `pending`
- âœ… ÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© "Ù‚ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©"
- âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† custody Ø¨Ø¹Ø¯

3. Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª â†’ Ø§Ø¶ØºØ· "âœ”" Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… expense status = `approved`
- âœ… approval status = `approved` + `decided_by` = user_id
- âœ… ØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† custody balance
- âœ… Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ¸Ù (Ù„Ùˆ ØªÙ… ØªÙ†ÙÙŠØ° notification system)

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 4: Ø±ÙØ¶ Ù…ØµØ±ÙˆÙ

1. Ø£Ø¶Ù Ù…ØµØ±ÙˆÙ Ø¨Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ± (Ù…Ø«Ù„Ø§Ù‹ 1000)
2. Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª â†’ Ø§Ø¶ØºØ· "âœ—"
3. Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨: `Ù…Ø±ÙÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­`

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… expense status = `rejected`
- âœ… approval status = `rejected`
- âœ… ØªÙ… Ø­ÙØ¸ comment Ø§Ù„Ø±ÙØ¶
- âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† custody

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 5: Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ

1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† custody balance ØµØºÙŠØ± (Ù…Ø«Ù„Ø§Ù‹ 100)
2. Ø­Ø§ÙˆÙ„ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¨Ù…Ø¨Ù„Øº 1000 Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ù‡ custody

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£: "Insufficient custody balance"
- âœ… Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ expense
- âœ… Ø±ØµÙŠØ¯ custody Ù„Ù… ÙŠØªØºÙŠØ±

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 6: ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù

1. Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„Ùƒ
2. Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙˆØ¸Ù (Ø³ÙŠÙØªØ±Ø¶ Supabase Ø£Ù†Ù‡ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ù„ÙƒÙ† ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø³ÙŠÙƒÙˆÙ† invite)
3. Ø£Ùˆ Ø§Ø®ØªØ¨Ø± Ø§Ù„Ù€ RLS:

ÙÙŠ Supabase SQL Editor:

```sql
-- ÙƒÙ€ ownerØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© ÙƒÙ„ Ø´ÙŠØ¡
SELECT * FROM expenses WHERE company_id = 'your-company-id';

-- ÙƒÙ€ employeeØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© Ù…ØµØ±ÙˆÙØ§ØªÙƒ ÙÙ‚Ø·
-- (Ø§ÙØªØ±Ø¶ Ø£Ù† user_id Ù‡Ùˆ Ù„Ù„Ù…ÙˆØ¸Ù)
SELECT * FROM expenses WHERE created_by = 'employee-user-id' AND company_id = 'your-company-id';
```

**Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
- âœ… Ø§Ù„Ù…ÙˆØ¸Ù ÙŠØ±Ù‰ Ù…ØµØ±ÙˆÙØ§ØªÙ‡ ÙÙ‚Ø·
- âœ… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ø§ ÙŠØ±Ù‰ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
- âœ… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
- âœ… Ø§Ù„Ù…Ø§Ù„Ùƒ/Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ ÙŠØ±ÙˆÙ† ÙƒÙ„ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ø±ÙƒØ©

## ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„

### ÙÙŠ Supabase Dashboard:

1. **Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„Ùƒ**:
   ```sql
   SELECT * FROM companies WHERE created_by = 'owner-user-id';
   ```

2. **Ø§Ù„Ø£Ø¯ÙˆØ§Ø±**:
   ```sql
   SELECT * FROM user_roles WHERE company_id = 'your-company-id';
   ```

3. **Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª**:
   ```sql
   SELECT
     e.*,
     ec.name as category,
     p.full_name as created_by_name
   FROM expenses e
   LEFT JOIN expense_categories ec ON e.category_id = ec.id
   LEFT JOIN profiles p ON e.created_by = p.id
   WHERE e.company_id = 'your-company-id';
   ```

4. **Ø§Ù„Ø¹Ù‡Ø¯**:
   ```sql
   SELECT
     c.*,
     p.full_name,
     (c.initial_amount - c.current_balance) as used
   FROM custodies c
   JOIN profiles p ON c.user_id = p.id
   WHERE c.company_id = 'your-company-id';
   ```

5. **Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª**:
   ```sql
   SELECT
     a.*,
     e.description as expense_description,
     e.amount as expense_amount,
     p.full_name as approver_name
   FROM approvals a
   JOIN expenses e ON a.expense_id = e.id
   LEFT JOIN profiles p ON a.decided_by = p.id
   WHERE a.company_id = 'your-company-id';
   ```

## ğŸ“Š Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† RLS Policies

ÙÙŠ Supabase SQL Editor:

```sql
-- ØªÙØ¹ÙŠÙ„ row_security
SELECT * FROM pg_tables WHERE schemaname = 'public' AND rowsecurity = true;

-- Ø¹Ø±Ø¶ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
SELECT
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual,
  with_check
FROM pg_policies
WHERE schemaname = 'public'
ORDER BY tablename, policyname;
```

Ù†ØªÙŠØ¬Ø© Ù…ØªÙˆÙ‚Ø¹Ø©:
- âœ… ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù„Ø¯ÙŠÙ‡Ø§ `rowsecurity = true`
- âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø³Ø§Øª `USING (true)`
- âœ… ÙƒÙ„ Ø³ÙŠØ§Ø³Ø© ØªØ³ØªØ®Ø¯Ù… `company_id = auth_company_id()` Ø£Ùˆ Ø´Ø±ÙˆØ· Ù…Ø´Ø§Ø¨Ù‡Ø©

## ğŸš€ Ø§Ù„Ù†Ø´Ø± Ù„Ù„Ø¥Ù†ØªØ§Ø¬

### Vercel (Frontend)

1. Ø§Ø¯ÙØ¹ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù€ GitHub
2. Ø§ÙØªØ­ https://vercel.com
3. Import Project Ù…Ù† GitHub
4. ÙÙŠ Environment Variables:
   ```
   NEXT_PUBLIC_SUPABASE_URL = (Ù…Ù† Supabase)
   NEXT_PUBLIC_SUPABASE_ANON_KEY = (Ù…Ù† Supabase)
   ```
5. Deploy

### Supabase (Backend)

1. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Migration SQL
2. ÙØ¹Ù‘Ù„ Email Confirmations Ù„Ù„Ø¥Ù†ØªØ§Ø¬
3. Ø£Ø¶Ù custom domain Ù„Ùˆ Ù…Ø·Ù„ÙˆØ¨

## ğŸ› Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### Ù…Ø´ÙƒÙ„Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØµØ±ÙˆÙ

**Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:**
- Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
- User Ù„ÙŠØ³ Ù„Ù‡ company_id (Ø¹Ø·Ù„ in onboarding)
- RLS policy ØªÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„

**Ø§Ù„Ø­Ù„:**
```sql
-- ØªØ­Ù‚Ù‚ Ù…Ù† profile
SELECT * FROM profiles WHERE id = auth.uid();

-- ØªØ­Ù‚Ù‚ Ù…Ù† company
SELECT * FROM companies WHERE id = (SELECT company_id FROM profiles WHERE id = auth.uid());
```

### Ù…Ø´ÙƒÙ„Ø©: Auto-approve Ù„Ø§ ÙŠØ¹Ù…Ù„

**Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨:**
- Ø§Ù„Ù…Ø¨Ù„Øº >= 500
- function Ù„Ù… ØªÙÙ†Ø´Ø£ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

**Ø§Ù„Ø­Ù„:**
```sql
-- ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ function
SELECT routine_name FROM information_schema.routines
WHERE routine_schema = 'public' AND routine_name = 'submit_expense';
```

### Ù…Ø´ÙƒÙ„Ø©: Custody balance Ù„Ø§ ÙŠØªØ­Ø¯Ø«

**Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨:**
- expense Ù„ÙŠØ³ Ù„Ù‡ custody_id
- Custody balance ØºÙŠØ± ÙƒØ§ÙÙŠ
- approve Ù„Ù… ÙŠÙÙ†ÙØ° Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

**Ø§Ù„Ø­Ù„:**
```sql
-- ØªØ­Ù‚Ù‚ Ù…Ù† custody
SELECT * FROM custodies WHERE id = 'custody-id';

-- ØªØ­Ù‚Ù‚ Ù…Ù† approvals
SELECT * FROM approvals WHERE expense_id = 'expense-id';
```

## ğŸ“„ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª

```
HAMADA SYSTEM/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ register/page.tsx (Onboarding)
â”‚   â”‚   â”‚   â””â”€â”€ callback/page.tsx
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx (Main Dashboard)
â”‚   â”‚   â”‚   â”œâ”€â”€ expenses/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx (List + Approve/Reject)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ new/page.tsx (Create)
â”‚   â”‚   â”‚   â”œâ”€â”€ custodies/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx (List)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ new/page.tsx (Create)
â”‚   â”‚   â”‚   â”œâ”€â”€ policies/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ users/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx (Landing)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ DashboardHeader.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts
â”‚   â”‚   â”œâ”€â”€ supabase-server.ts
â”‚   â”‚   â”œâ”€â”€ auth-utils.ts
â”‚   â”‚   â”œâ”€â”€ format-utils.ts
â”‚   â”‚   â”œâ”€â”€ schemas.ts
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â””â”€â”€ middleware.ts
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 010_saas_production_patch.sql (Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ÙƒØ§Ù…Ù„)
â”œâ”€â”€ types/
â”‚   â””â”€â”€ database.types.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ vercel.json
â”œâ”€â”€ .env.local.example
â””â”€â”€ README.md
```

## ğŸ¯ Acceptance Criteria - Pass/Fail

| Ø§Ù„Ù…Ø¹ÙŠØ§Ø± | Ø§Ù„Ù†ØªÙŠØ¬Ø© |
|---------|---------|
| âœ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹ Onboarding | PASS |
| âœ… Ø¥Ù†Ø´Ø§Ø¡ Company ØªÙ„Ù‚Ø§Ø¦ÙŠ | PASS |
| âœ… ØªØ¹ÙŠÙŠÙ† Owner role ØªÙ„Ù‚Ø§Ø¦ÙŠ | PASS |
| âœ… Seed expense categories | PASS |
| âœ… Seed projects/cost centers (contracting) | PASS |
| âœ… Auto-approve < 500 SAR | PASS |
| âœ… Approval workflow | PASS |
| âœ… Custody deduction on approval | PASS |
| âœ… Ù…Ù†Ø¹ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù„Ùˆ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ | PASS |
| âœ… RLS Policies company-scoped | PASS |
| âœ… Owner ÙŠØ±Ù‰ ÙƒÙ„ Ø´ÙŠØ¡ | PASS |
| âœ… Employee ÙŠØ±Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙÙ‚Ø· | PASS |
| âœ… Accountant ÙŠØ¹ØªÙ…Ø¯ ÙˆÙŠÙ†Ø´Ø¦ | PASS |
| âœ… Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª | PASS |
| âœ… Dashboard stats Ø­Ù‚ÙŠÙ‚ÙŠØ© | PASS |
| âœ… Ù„Ø§ Mock data ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ | PASS |

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù…

Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ: support@smartcash.sa

## ğŸ“ Ø§Ù„ØªØ±Ø®ÙŠØµ

MIT License
